<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ignite Management System (GitHub Sync)</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">

<style>
/* ------------------------- VARIABLES & GLOBAL ------------------------- */
:root {
    --primary: #6db2ff;
    --bg-dark: #111;
    --bg-card: #1a1a1a;
    --text-main: #f2f2f2;
    --text-muted: #aaa;
    --sidebar-width: 260px;
    --global-font-size: 16px;
}

body {
    margin: 0;
    font-family: 'Prompt', sans-serif;
    background: #0a0a0a;
    color: var(--text-main);
    display: flex;
    height: 100vh;
    overflow: hidden;
    font-size: var(--global-font-size);
}

* { box-sizing: border-box; }

/* ------------------------- LOADING OVERLAY ------------------------- */
#loadingOverlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 9999;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    backdrop-filter: blur(5px);
}
.spinner {
    width: 50px; height: 50px;
    border: 5px solid #333;
    border-top: 5px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 15px;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* ------------------------- SIDEBAR ------------------------- */
.sidebar {
    width: var(--sidebar-width);
    background: #151515;
    border-right: 1px solid #333;
    display: flex;
    flex-direction: column;
    padding: 20px 15px;
    flex-shrink: 0;
    transition: 0.3s;
}

.sidebar h2 {
    text-align: center;
    margin: 0 0 30px 0;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 2px;
    font-size: 1.4em;
    cursor: pointer;
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 12px 15px;
    margin-bottom: 8px;
    background: transparent;
    border-radius: 8px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.95em;
}

.menu-item:hover, .menu-item.active {
    background: rgba(109, 178, 255, 0.15);
    color: var(--primary);
    font-weight: 600;
}

/* ------------------------- MAIN CONTENT ------------------------- */
.main {
    flex-grow: 1;
    padding: 30px;
    overflow-y: auto;
    background: #0a0a0a;
}

/* DASHBOARD GRID */
.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-box {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid #333;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.stat-title { font-size: 0.85em; color: #888; margin-bottom: 5px; }
.stat-value { font-size: 1.8em; font-weight: bold; }
.green { color: #00ff88; }
.red { color: #ff4444; }
.blue { color: #6db2ff; }
.gold { color: #ffd700; }

/* CARDS & FORMS */
.card {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 16px;
    border: 1px solid #333;
    margin-bottom: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
}

.form-wrapper {
    max-width: 600px;
    margin: 0 auto;
}

/* SETTINGS GRID LAYOUT */
.settings-group {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 20px;
}

.settings-group .card {
    margin-bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

h3 { margin-top: 0; color: var(--primary); margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }

/* INPUTS */
.form-group { margin-bottom: 15px; }
label { display: block; margin-bottom: 5px; font-size: 0.9em; color: #ccc; }

input, select, textarea {
    width: 100%;
    padding: 12px;
    background: #0d0d0d;
    border: 1px solid #444;
    border-radius: 8px;
    color: white;
    font-family: 'Prompt', sans-serif;
    font-size: 1em;
    transition: 0.2s;
}
input:focus, textarea:focus { border-color: var(--primary); outline: none; }

/* FILE UPLOAD */
.file-upload {
    border: 2px dashed #444;
    padding: 20px;
    text-align: center;
    border-radius: 8px;
    cursor: pointer;
    margin-bottom: 15px;
    transition: 0.2s;
}
.file-upload:hover { border-color: var(--primary); background: #111; }
input[type="file"] { display: none; }

/* BUTTONS */
.btn {
    width: 100%;
    padding: 12px;
    background: var(--primary);
    color: #000;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    font-size: 1em;
    transition: 0.2s;
}
.btn:hover { filter: brightness(1.1); transform: translateY(-2px); }
.btn-del { background: #ff4444; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size:0.8em; border:none; }

/* TABLE */
.table-container { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; min-width: 600px; }
th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #333; }
th { color: #888; font-weight: 400; font-size: 0.9em; }
td { background: rgba(255,255,255,0.02); }
tr:hover td { background: rgba(255,255,255,0.05); }

.slip-preview { height: 40px; border-radius: 4px; cursor: pointer; transition: .2s; }
.slip-preview:hover { transform: scale(2); z-index: 99; position: relative; box-shadow: 0 0 10px black; }

/* SETTINGS UI */
.settings-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #333; flex-wrap: wrap; gap: 5px; }
.tab-btn {
    padding: 10px 15px;
    cursor: pointer;
    background: transparent;
    color: #888;
    border: none;
    font-size: 0.95em;
    font-family: 'Prompt', sans-serif;
    border-radius: 5px 5px 0 0;
}
.tab-btn:hover { background: rgba(255,255,255,0.05); }
.tab-btn.active { color: var(--primary); border-bottom: 2px solid var(--primary); font-weight: bold; background: rgba(109, 178, 255, 0.1); }

.settings-section { display: none; animation: fadeIn 0.3s; }
.settings-section.active { display: block; }

.config-row {
    display: grid;
    grid-template-columns: 1fr 2fr 80px;
    gap: 10px;
    align-items: center;
    margin-bottom: 10px;
    padding: 10px;
    background: rgba(255,255,255,0.03);
    border-radius: 8px;
}
.config-row label { margin: 0; color: var(--primary); font-size: 0.85em; }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* RESPONSIVE */
@media screen and (max-width: 1000px) {
    .settings-group { grid-template-columns: 1fr; }
}

@media screen and (max-width: 768px) {
    .sidebar { position: fixed; left: -260px; z-index: 100; height: 100%; }
    .sidebar.open { left: 0; }
    .main { padding: 15px; margin-left: 0; width: 100%; }
    .mobile-toggle { display: block; position: fixed; top: 15px; right: 15px; z-index: 101; background: var(--primary); color: #000; padding: 8px 12px; border-radius: 5px; font-weight: bold; cursor: pointer; }
    .config-row { grid-template-columns: 1fr; gap: 5px; }
}
@media screen and (min-width: 769px) { .mobile-toggle { display: none; } }
</style>
</head>

<body>

<div id="loadingOverlay" style="display:none;">
    <div class="spinner"></div>
    <div id="loadingText" style="font-weight:bold;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ GitHub...</div>
</div>

<div class="mobile-toggle" onclick="toggleSidebar()">‚ò∞ ‡πÄ‡∏°‡∏ô‡∏π</div>

<div class="sidebar" id="sidebar">
    <h2 id="brandName" onclick="showPage('home')">IGNITE</h2>
    
    <div class="menu-item active" onclick="showPage('home')">
        <span id="lbl_home">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
    </div>
    <div class="menu-item" onclick="showPage('buy')">
        <span id="lbl_buy">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤</span>
    </div>
    <div class="menu-item" onclick="showPage('sell')">
        <span id="lbl_sell">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</span>
    </div>
    <div class="menu-item" onclick="showPage('stock')">
        <span id="lbl_stock">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
    </div>
    <div class="menu-item" onclick="showPage('melt')">
        <span id="lbl_melt">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≠‡∏´‡∏•‡∏≠‡∏°</span>
    </div>
    <div class="menu-item" onclick="showPage('expense')">
        <span id="lbl_exp">‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</span>
    </div>
    <div class="menu-item" onclick="showPage('note')">
        <span id="lbl_note">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥</span>
    </div>
    <div class="menu-item" onclick="showPage('summary')">
        <span id="lbl_sum">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
    </div>
    
    <div style="margin-top: auto; border-top: 1px solid #333; padding-top: 10px;">
        <div class="menu-item" onclick="showPage('setting')">
            <span id="lbl_set">‚öô ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span>
        </div>
    </div>
</div>

<div class="main">
    <div id="home" class="page">
        <h3>üíº ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£</h3>
        <div class="dashboard-stats">
            <div class="stat-box">
                <span class="stat-title">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô</span>
                <span class="stat-value gold" id="d_capital">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-title">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                <span class="stat-value blue" id="d_balance">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-title">üìà ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                <span class="stat-value green" id="d_profit">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-title">üìâ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</span>
                <span class="stat-value red" id="d_expense">0</span>
            </div>
        </div>

        <div class="card">
            <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
            <input id="searchAll" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="searchAllData()">
            <div class="table-container">
                <table>
                    <thead>
                        <tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏™‡∏•‡∏µ‡∏õ</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
                    </thead>
                    <tbody id="allData"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="buy" class="page" style="display:none;">
        <div class="card form-wrapper">
            <h3 id="ui_buy_title">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤</h3>
            <div class="form-group" id="grp_buy_name"><label id="ui_buy_lbl_name">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input id="buyName"></div>
            <div class="form-group" id="grp_buy_price"><label id="ui_buy_lbl_price">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠</label><input id="buyPrice" type="number"></div>
            <div class="form-group" id="grp_buy_date"><label id="ui_buy_lbl_date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label><input id="buyDate" type="date"></div>
            <div class="form-group" id="grp_buy_slip">
                <label id="ui_buy_lbl_slip">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏µ‡∏õ</label>
                <label class="file-upload"><span id="buyFileName">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...</span><input id="buySlip" type="file" accept="image/*" onchange="previewFile('buySlip', 'buyFileName')"></label>
            </div>
            <button class="btn" onclick="addTransaction('buy')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>

    <div id="sell" class="page" style="display:none;">
        <div class="card form-wrapper">
            <h3 id="ui_sell_title">üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h3>
            <div class="form-group" id="grp_sell_name"><label id="ui_sell_lbl_name">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label><input id="sellName"></div>
            <div class="form-group" id="grp_sell_price"><label id="ui_sell_lbl_price">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</label><input id="sellPrice" type="number"></div>
            <div class="form-group" id="grp_sell_date"><label id="ui_sell_lbl_date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label><input id="sellDate" type="date"></div>
            <div class="form-group" id="grp_sell_slip">
                <label id="ui_sell_lbl_slip">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏µ‡∏õ</label>
                <label class="file-upload"><span id="sellFileName">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...</span><input id="sellSlip" type="file" accept="image/*" onchange="previewFile('sellSlip', 'sellFileName')"></label>
            </div>
            <button class="btn" onclick="addTransaction('sell')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>

    <div id="expense" class="page" style="display:none;">
        <div class="card form-wrapper">
            <h3 id="ui_exp_title">üìÑ ‡∏•‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h3>
            <div class="form-group" id="grp_exp_name"><label id="ui_exp_lbl_name">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</label><input id="expName"></div>
            <div class="form-group" id="grp_exp_price"><label id="ui_exp_lbl_price">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label><input id="expPrice" type="number"></div>
            <div class="form-group" id="grp_exp_date"><label id="ui_exp_lbl_date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</label><input id="expDate" type="date"></div>
            <div class="form-group" id="grp_exp_slip">
                <label id="ui_exp_lbl_slip">‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</label>
                <label class="file-upload"><span id="expFileName">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...</span><input id="expSlip" type="file" accept="image/*" onchange="previewFile('expSlip', 'expFileName')"></label>
            </div>
            <button class="btn" onclick="addTransaction('expense')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>

    <div id="stock" class="page" style="display:none;">
        <div class="card">
            <h3>üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
            <input id="stockSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="renderStock()">
            <div class="table-container">
                <table><thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤</th><th>‡∏ó‡∏∏‡∏ô</th></tr></thead><tbody id="stockList"></tbody></table>
            </div>
        </div>
    </div>

    <div id="melt" class="page" style="display:none;">
        <div class="card form-wrapper">
            <h3>üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏≠‡∏°</h3>
            <textarea id="meltTxt" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..."></textarea>
            <button class="btn" onclick="addGenericItem('melts', 'meltTxt', renderMelt)">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
        <div class="card"><ul id="meltList"></ul></div>
    </div>

    <div id="note" class="page" style="display:none;">
        <div class="card form-wrapper">
            <h3>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥</h3>
            <textarea id="noteTxt" rows="3" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."></textarea>
            <button class="btn" onclick="addGenericItem('notes', 'noteTxt', renderNotes)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
        <div class="card"><ul id="noteList"></ul></div>
    </div>

    <div id="summary" class="page" style="display:none;">
        <div class="card form-wrapper">
            <h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
            <select id="sumMonth" onchange="calculateMonthly()"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô --</option></select>
            <div id="summaryResult" style="margin-top:20px;text-align:center;"></div>
        </div>
    </div>

    <div id="setting" class="page" style="display:none;">
        <div class="settings-group">
            <div class="card" style="border: 1px solid #5865F2;">
                <h3 style="color:#5865F2;border-color:#5865F2; font-size:1.1em;">üëæ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Discord</h3>
                <div class="form-group"><label>Webhook URL</label><input id="discordWebhook" placeholder="https://discord.com..." onchange="saveDiscordWebhook()"></div>
            </div>
            <div class="card">
                <h3 style="font-size:1.1em;">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô</h3>
                <div class="form-group"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label><input id="setCapital" type="number" placeholder="0.00"></div>
                <button class="btn" onclick="saveCapital()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
            <div class="card" style="border: 1px solid #ff4444;">
                <h3 style="color:#ff4444;border-color:#ff4444; font-size:1.1em;">‚ö† ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <p style="color:#aaa; font-size:0.85em; margin-bottom:auto;">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</p>
                <button class="btn" onclick="clearAllData()" style="background:#ff4444; margin-top:10px;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
        <div class="card">
            <h3>‚öô ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <div class="settings-tabs">
                <button class="tab-btn active" onclick="openTab('tab_general')">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
                <button class="tab-btn" onclick="openTab('tab_menu')">‡πÄ‡∏°‡∏ô‡∏π</button>
                <button class="tab-btn" onclick="openTab('tab_buy')">‡∏´‡∏ô‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠</button>
                <button class="tab-btn" onclick="openTab('tab_sell')">‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</button>
                <button class="tab-btn" onclick="openTab('tab_exp')">‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</button>
            </div>

            <div id="tab_general" class="settings-section active">
                <div class="config-row"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label><input id="conf_brand" placeholder="‡πÄ‡∏ä‡πà‡∏ô Ignite"><div></div></div>
                <div class="config-row"><label>‡∏™‡∏µ‡∏ò‡∏µ‡∏°</label><input id="conf_color" type="color" style="height:40px;"><div></div></div>
                <div class="config-row"><label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</label><input id="conf_fontsize" type="number"><div></div></div>
            </div>
            <div id="tab_menu" class="settings-section">
                <div class="config-row"><label>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</label><input id="cf_m_home"><div></div></div>
                <div class="config-row"><label>‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤</label><input id="cf_m_buy"><div></div></div>
                <div class="config-row"><label>‡∏Ç‡∏≤‡∏¢</label><input id="cf_m_sell"><div></div></div>
                <div class="config-row"><label>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label><input id="cf_m_stock"><div></div></div>
                <div class="config-row"><label>‡∏£‡∏≠‡∏´‡∏•‡∏≠‡∏°</label><input id="cf_m_melt"><div></div></div>
                <div class="config-row"><label>‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</label><input id="cf_m_exp"><div></div></div>
                <div class="config-row"><label>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label><input id="cf_m_note"><div></div></div>
                <div class="config-row"><label>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</label><input id="cf_m_sum"><div></div></div>
            </div>
            <div id="tab_buy" class="settings-section">
                <div class="config-row"><label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</label><input id="cf_buy_title"><div></div></div>
                <div class="config-row"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input id="cf_buy_lbl_name"><div></div></div>
                <div class="config-row"><label>‡∏£‡∏≤‡∏Ñ‡∏≤</label><input id="cf_buy_lbl_price"><div></div></div>
                <div class="config-row"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input id="cf_buy_lbl_date"><label><input type="checkbox" id="cf_buy_show_date"> ‡πÅ‡∏™‡∏î‡∏á</label></div>
                <div class="config-row"><label>‡∏™‡∏•‡∏µ‡∏õ</label><input id="cf_buy_lbl_slip"><label><input type="checkbox" id="cf_buy_show_slip"> ‡πÅ‡∏™‡∏î‡∏á</label></div>
            </div>
            <div id="tab_sell" class="settings-section">
                <div class="config-row"><label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</label><input id="cf_sell_title"><div></div></div>
                <div class="config-row"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input id="cf_sell_lbl_name"><div></div></div>
                <div class="config-row"><label>‡∏£‡∏≤‡∏Ñ‡∏≤</label><input id="cf_sell_lbl_price"><div></div></div>
                <div class="config-row"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input id="cf_sell_lbl_date"><label><input type="checkbox" id="cf_sell_show_date"> ‡πÅ‡∏™‡∏î‡∏á</label></div>
                <div class="config-row"><label>‡∏™‡∏•‡∏µ‡∏õ</label><input id="cf_sell_lbl_slip"><label><input type="checkbox" id="cf_sell_show_slip"> ‡πÅ‡∏™‡∏î‡∏á</label></div>
            </div>
            <div id="tab_exp" class="settings-section">
                <div class="config-row"><label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</label><input id="cf_exp_title"><div></div></div>
                <div class="config-row"><label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label><input id="cf_exp_lbl_name"><div></div></div>
                <div class="config-row"><label>‡∏£‡∏≤‡∏Ñ‡∏≤</label><input id="cf_exp_lbl_price"><div></div></div>
                <div class="config-row"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input id="cf_exp_lbl_date"><label><input type="checkbox" id="cf_exp_show_date"> ‡πÅ‡∏™‡∏î‡∏á</label></div>
                <div class="config-row"><label>‡∏™‡∏•‡∏µ‡∏õ</label><input id="cf_exp_lbl_slip"><label><input type="checkbox" id="cf_exp_show_slip"> ‡πÅ‡∏™‡∏î‡∏á</label></div>
            </div>

            <button class="btn" onclick="saveAdvancedConfig()" style="margin-top:20px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            <button class="btn" onclick="resetConfig()" style="margin-top:10px; background:#444; color:#ccc;">‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
        </div>
    </div>

</div>

<script>
/* ------------------------- GITHUB API CONFIG ------------------------- */
// ‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
const GH_USER = "jadum2606";        // ‡∏ä‡∏∑‡πà‡∏≠ User GitHub ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
const GH_TOKEN = "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"; // üîë ‡πÉ‡∏™‡πà Token (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢ ghp_...)
const GH_REPO = "IGNITE";   // üìÇ ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠ Repository (‡πÄ‡∏ä‡πà‡∏ô ignite-shop)

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GitHub API (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)
function utf8_to_b64(str) { return window.btoa(unescape(encodeURIComponent(str))); }
function b64_to_utf8(str) { return decodeURIComponent(escape(window.atob(str))); }

// ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô Loading Screen
function setLoading(isLoading, text) {
    const ol = document.getElementById('loadingOverlay');
    if(isLoading) {
        document.getElementById('loadingText').innerText = text || "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...";
        ol.style.display = 'flex';
    } else {
        ol.style.display = 'none';
    }
}

// üì• ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å GitHub
async function fetchFromGitHub(filename) {
    if(!GH_TOKEN || GH_TOKEN.includes("YOUR_TOKEN")) return null; // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà Token
    
    const url = `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/${filename}`;
    try {
        const response = await fetch(url, {
            headers: { 'Authorization': `token ${GH_TOKEN}`, 'Accept': 'application/vnd.github.v3+json' }
        });
        if (!response.ok) return null;
        const json = await response.json();
        const content = b64_to_utf8(json.content); 
        return JSON.parse(content);
    } catch (error) {
        console.error(`Error loading ${filename}:`, error);
        return null;
    }
}

// üì§ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏á GitHub
async function saveToGitHub(filename, dataObj) {
    if(!GH_TOKEN || GH_TOKEN.includes("YOUR_TOKEN")) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà GitHub Token ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå");
        return;
    }

    setLoading(true, `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${filename}...`);
    const url = `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/${filename}`;

    // 1. ‡∏´‡∏≤ SHA ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô (‡∏Å‡∏é‡∏Ç‡∏≠‡∏á GitHub)
    let sha = null;
    try {
        const getRes = await fetch(url, { headers: { 'Authorization': `token ${GH_TOKEN}` } });
        if(getRes.ok) {
            const getJson = await getRes.json();
            sha = getJson.sha;
        }
    } catch(e) { console.log("New file creation"); }

    // 2. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const body = {
        message: `Update ${filename} via WebApp`,
        content: utf8_to_b64(JSON.stringify(dataObj, null, 2)),
        sha: sha
    };

    // 3. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    try {
        const res = await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${GH_TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        setLoading(false);
        if(!res.ok) {
            const err = await res.json();
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å GitHub ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err.message);
        } else {
            console.log("Saved to GitHub:", filename);
        }
    } catch (error) {
        setLoading(false);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ GitHub");
    }
}

/* ------------------------- APP DATA & LOGIC ------------------------- */
let db = { buys: [], sells: [], expenses: [], melts: [], notes: [] };
let capital = 0;
let discordUrl = "";

const defaultConfig = {
    brand: "IGNITE", fontSize: 16, color: "#6db2ff",
    menus: { home: "‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å", buy: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤", sell: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢", stock: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠", melt: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≠‡∏´‡∏•‡∏≠‡∏°", exp: "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", note: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥", sum: "‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" },
    pages: {
        buy: { title: "‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤", labels: { name: "‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡∏£‡∏∏‡πà‡∏ô / ‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠", price: "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó)", date: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠", slip: "‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏µ‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô" }, show: { date: true, slip: true } },
        sell: { title: "üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢", labels: { name: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢", price: "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)", date: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢", slip: "‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏µ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô" }, show: { date: true, slip: true } },
        expense: { title: "üìÑ ‡∏•‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", labels: { name: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", price: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)", date: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢", slip: "‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô" }, show: { date: true, slip: true } }
    }
};
let config = JSON.parse(JSON.stringify(defaultConfig));

/* INIT SYSTEM */
async function loadData() {
    setLoading(true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å GitHub...");

    // ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å GitHub ‡∏Å‡πà‡∏≠‡∏ô
    const [ghBuys, ghSells, ghExp, ghMelts, ghNotes, ghConf, ghCap, ghDis] = await Promise.all([
        fetchFromGitHub('buys.json'),
        fetchFromGitHub('sells.json'),
        fetchFromGitHub('expenses.json'),
        fetchFromGitHub('melts.json'),
        fetchFromGitHub('notes.json'),
        fetchFromGitHub('config.json'),
        fetchFromGitHub('capital.json'), // ‡πÅ‡∏¢‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å‡πÜ
        fetchFromGitHub('discord.json')
    ]);

    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÉ‡∏ô GitHub ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á GitHub, ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ä‡πâ LocalStorage ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
    db.buys = ghBuys || JSON.parse(localStorage.getItem("buys") || "[]");
    db.sells = ghSells || JSON.parse(localStorage.getItem("sells") || "[]");
    db.expenses = ghExp || JSON.parse(localStorage.getItem("expenses") || "[]");
    db.melts = ghMelts || JSON.parse(localStorage.getItem("melts") || "[]");
    db.notes = ghNotes || JSON.parse(localStorage.getItem("notes") || "[]");
    
    if(ghConf) config = ghConf;
    else if(localStorage.getItem("config")) config = JSON.parse(localStorage.getItem("config"));

    if(ghCap) capital = ghCap.value;
    else capital = Number(localStorage.getItem("capital") || 0);

    if(ghDis) discordUrl = ghDis.url;
    else discordUrl = localStorage.getItem("discordWebhook") || "";

    // Save backup to local immediately
    saveToLocalBackup(); 

    [...db.buys, ...db.sells, ...db.expenses].forEach(x => { if(!x.id) x.id = Date.now() + Math.random(); });
    
    setLoading(false);
    applyConfig();
    updateDashboard();
    renderStock();
    renderMelt();
    renderNotes();
    document.getElementById("setCapital").value = capital;
    document.getElementById("discordWebhook").value = discordUrl;
    loadConfigToInputs();
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ LocalStorage (Backup)
function saveToLocalBackup() {
    localStorage.setItem("buys", JSON.stringify(db.buys));
    localStorage.setItem("sells", JSON.stringify(db.sells));
    localStorage.setItem("expenses", JSON.stringify(db.expenses));
    localStorage.setItem("melts", JSON.stringify(db.melts));
    localStorage.setItem("notes", JSON.stringify(db.notes));
    localStorage.setItem("capital", capital);
    localStorage.setItem("discordWebhook", discordUrl);
    localStorage.setItem("config", JSON.stringify(config));
}

// Sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î request)
async function syncData(type) {
    saveToLocalBackup(); // ‡πÄ‡∏ã‡∏ü‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠
    updateDashboard();   // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ GitHub

    // ‡∏™‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô GitHub ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ
    if(type === 'buy') await saveToGitHub('buys.json', db.buys);
    else if(type === 'sell') await saveToGitHub('sells.json', db.sells);
    else if(type === 'expense') await saveToGitHub('expenses.json', db.expenses);
    else if(type === 'melt') await saveToGitHub('melts.json', db.melts);
    else if(type === 'note') await saveToGitHub('notes.json', db.notes);
    else if(type === 'config') await saveToGitHub('config.json', config);
    else if(type === 'capital') await saveToGitHub('capital.json', { value: capital });
    else if(type === 'discord') await saveToGitHub('discord.json', { url: discordUrl });
    else if(type === 'all') {
        await saveToGitHub('buys.json', db.buys);
        await saveToGitHub('sells.json', db.sells);
        await saveToGitHub('expenses.json', db.expenses);
        await saveToGitHub('melts.json', db.melts);
        await saveToGitHub('notes.json', db.notes);
    }
}

/* DISCORD */
async function sendToDiscord(title, desc, color) {
    if(!discordUrl) return;
    try {
        await fetch(discordUrl, {
            method: "POST", headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username: "Ignite System", embeds: [{ title: title, description: desc, color: color }] })
        });
    } catch(e) { console.error("Discord Error", e); }
}

/* ACTIONS */
function saveDiscordWebhook() {
    discordUrl = document.getElementById("discordWebhook").value;
    syncData('discord');
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Webhook ‡πÅ‡∏•‡πâ‡∏ß");
}

function clearAllData() {
    if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ‡∏ö‡∏ô GitHub?")) {
        db.buys = []; db.sells = []; db.expenses = []; db.melts = []; db.notes = [];
        syncData('all');
        alert("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        renderStock(); renderMelt(); renderNotes();
    }
}

async function addTransaction(type) {
    const ids = {
        buy: { name: 'buyName', price: 'buyPrice', date: 'buyDate', slip: 'buySlip' },
        sell: { name: 'sellName', price: 'sellPrice', date: 'sellDate', slip: 'sellSlip' },
        expense: { name: 'expName', price: 'expPrice', date: 'expDate', slip: 'expSlip' }
    };
    const fields = ids[type];
    const name = document.getElementById(fields.name).value;
    const price = Number(document.getElementById(fields.price).value);
    let date = document.getElementById(fields.date).value;
    const isDateHidden = document.getElementById(`grp_${type}_date`).style.display === 'none';
    if(isDateHidden && !date) date = new Date().toISOString().split('T')[0];

    if(!name || !price || (!isDateHidden && !date)) { alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö"); return; }

    let slipImg = "";
    const fileInput = document.getElementById(fields.slip);
    if(fileInput.files[0]) slipImg = await getBase64(fileInput.files[0]);

    let entry = { id: Date.now(), type: type=='buy'?'‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤':type=='sell'?'‡∏Ç‡∏≤‡∏¢':'‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢', name, price, date, slip: slipImg };
    if(type === 'buy') db.buys.push(entry);
    else if(type === 'sell') db.sells.push(entry);
    else db.expenses.push(entry);

    // Sync ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
    await syncData(type);

    let colors = { buy: 3447003, sell: 5763719, expense: 15548997 };
    sendToDiscord(`üîî ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ${entry.type}`, `${name} : ${price} ‡∏ö.`, colors[type]);
    
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞ Sync GitHub ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    document.getElementById(fields.name).value = "";
    document.getElementById(fields.price).value = "";
    document.getElementById(fields.slip).value = "";
    showPage('home');
}

function deleteTransaction(id) {
    if(!confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) return;
    
    let type = null;
    if(db.buys.find(x=>x.id==id)) { db.buys = db.buys.filter(x=>x.id!=id); type = 'buy'; }
    else if(db.sells.find(x=>x.id==id)) { db.sells = db.sells.filter(x=>x.id!=id); type = 'sell'; }
    else if(db.expenses.find(x=>x.id==id)) { db.expenses = db.expenses.filter(x=>x.id!=id); type = 'expense'; }
    
    if(type) syncData(type);
}

function addGenericItem(arr, id, render) {
    let val = document.getElementById(id).value;
    if(!val) return;
    db[arr].push(val);
    document.getElementById(id).value="";
    render();
    // Mapping array name to sync type
    let type = arr === 'melts' ? 'melt' : 'note';
    syncData(type);
}
function del(arr,i,render) {
    if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?")) { 
        db[arr].splice(i,1); 
        render();
        let type = arr === 'melts' ? 'melt' : 'note';
        syncData(type);
    }
}

/* SETTINGS UI LOGIC (‡∏¢‡πà‡∏≠) */
function openTab(tabId) {
    document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    event.target.classList.add('active');
}
function loadConfigToInputs() {
    document.getElementById("conf_brand").value = config.brand;
    document.getElementById("conf_fontsize").value = config.fontSize;
    document.getElementById("conf_color").value = config.color;
    document.getElementById("cf_m_home").value = config.menus.home;
    // ... (Load input values logic - similar to original) ...
    // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î ‡∏ú‡∏°‡∏Ç‡∏≠‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô mapping ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ
    // (Code ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö applyConfig ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)
    ['buy','sell','exp','stock','melt','note','sum'].forEach(k => {
        if(document.getElementById(`cf_m_${k}`)) document.getElementById(`cf_m_${k}`).value = config.menus[k] || "";
    });
    ['buy','sell','expense'].forEach(k => {
        let prefix = k=='expense'?'exp':k;
        let p = config.pages[k];
        document.getElementById(`cf_${prefix}_title`).value = p.title;
        document.getElementById(`cf_${prefix}_lbl_name`).value = p.labels.name;
        document.getElementById(`cf_${prefix}_lbl_price`).value = p.labels.price;
        document.getElementById(`cf_${prefix}_lbl_date`).value = p.labels.date;
        document.getElementById(`cf_${prefix}_show_date`).checked = p.show.date;
        document.getElementById(`cf_${prefix}_lbl_slip`).value = p.labels.slip;
        document.getElementById(`cf_${prefix}_show_slip`).checked = p.show.slip;
    });
}
function saveAdvancedConfig() {
    config.brand = document.getElementById("conf_brand").value;
    config.fontSize = document.getElementById("conf_fontsize").value;
    config.color = document.getElementById("conf_color").value;
    // ... (Save logic) ...
    ['home','buy','sell','stock','melt','exp','note','sum'].forEach(k => {
        let el = document.getElementById(`cf_m_${k}`);
        if(el) config.menus[k] = el.value;
    });
    const savePage = (key, prefix) => {
        config.pages[key].title = document.getElementById(`cf_${prefix}_title`).value;
        config.pages[key].labels.name = document.getElementById(`cf_${prefix}_lbl_name`).value;
        config.pages[key].labels.price = document.getElementById(`cf_${prefix}_lbl_price`).value;
        config.pages[key].labels.date = document.getElementById(`cf_${prefix}_lbl_date`).value;
        config.pages[key].show.date = document.getElementById(`cf_${prefix}_show_date`).checked;
        config.pages[key].labels.slip = document.getElementById(`cf_${prefix}_lbl_slip`).value;
        config.pages[key].show.slip = document.getElementById(`cf_${prefix}_show_slip`).checked;
    };
    savePage('buy', 'buy'); savePage('sell', 'sell'); savePage('expense', 'exp');

    applyConfig();
    syncData('config');
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏á GitHub ‡πÅ‡∏•‡πâ‡∏ß!");
}
function resetConfig() {
    if(confirm("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï?")) { config = JSON.parse(JSON.stringify(defaultConfig)); applyConfig(); syncData('config'); }
}
function applyConfig() {
    document.documentElement.style.setProperty('--primary', config.color);
    document.documentElement.style.setProperty('--global-font-size', config.fontSize + 'px');
    document.getElementById("brandName").innerText = config.brand;
    // ... Apply text labels ...
    document.getElementById("lbl_home").innerText = config.menus.home;
    document.getElementById("lbl_buy").innerText = config.menus.buy;
    document.getElementById("lbl_sell").innerText = config.menus.sell;
    document.getElementById("lbl_stock").innerText = config.menus.stock;
    document.getElementById("lbl_melt").innerText = config.menus.melt;
    document.getElementById("lbl_exp").innerText = config.menus.exp;
    document.getElementById("lbl_note").innerText = config.menus.note;
    document.getElementById("lbl_sum").innerText = config.menus.sum;
    
    const applyPage = (key, prefix) => {
        const p = config.pages[key];
        document.getElementById(`ui_${prefix}_title`).innerText = p.title;
        document.getElementById(`ui_${prefix}_lbl_name`).innerText = p.labels.name;
        document.getElementById(`ui_${prefix}_lbl_price`).innerText = p.labels.price;
        document.getElementById(`${prefix}Name`).placeholder = p.labels.name;
        document.getElementById(`ui_${prefix}_lbl_date`).innerText = p.labels.date;
        document.getElementById(`grp_${prefix}_date`).style.display = p.show.date ? "block" : "none";
        document.getElementById(`ui_${prefix}_lbl_slip`).innerText = p.labels.slip;
        document.getElementById(`grp_${prefix}_slip`).style.display = p.show.slip ? "block" : "none";
    };
    applyPage('buy', 'buy'); applyPage('sell', 'sell'); applyPage('expense', 'exp');
}

/* UTILS */
function showPage(pageId) {
    document.querySelectorAll(".page").forEach(p => p.style.display = "none");
    document.getElementById(pageId).style.display = "block";
    if(window.innerWidth <= 768) toggleSidebar(false);
}
function toggleSidebar(forceState) {
    const sb = document.getElementById("sidebar");
    if(forceState === false) sb.classList.remove("open");
    else sb.classList.toggle("open");
}
function saveCapital() {
    capital = Number(document.getElementById("setCapital").value);
    syncData('capital');
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
}
function previewFile(inputId, nameSpanId) {
    const file = document.getElementById(inputId).files[0];
    if(file) document.getElementById(nameSpanId).innerText = file.name;
}
function getBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}
function updateDashboard() {
    let b = db.buys.reduce((a,x)=>a+x.price,0);
    let s = db.sells.reduce((a,x)=>a+x.price,0);
    let e = db.expenses.reduce((a,x)=>a+x.price,0);
    let bal = capital + s - b - e;
    let prof = s - b - e;
    document.getElementById("d_capital").innerText = capital.toLocaleString();
    document.getElementById("d_balance").innerText = bal.toLocaleString();
    document.getElementById("d_profit").innerText = prof.toLocaleString();
    document.getElementById("d_profit").className = "stat-value " + (prof>=0?"green":"red");
    document.getElementById("d_expense").innerText = e.toLocaleString();
    let all = [...db.buys, ...db.sells, ...db.expenses].sort((x,y)=>new Date(y.date)-new Date(x.date));
    document.getElementById("allData").innerHTML = all.map(x => `
        <tr><td class="${x.type=='‡∏Ç‡∏≤‡∏¢'?'green':x.type=='‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤'?'blue':'red'}">${x.type}</td>
        <td>${x.name}</td><td>${x.price.toLocaleString()}</td><td>${x.date}</td>
        <td>${x.slip ? `<img src="${x.slip}" class="slip-preview" onclick="window.open('${x.slip}')">` : '-'}</td>
        <td><button class="btn-del" onclick="deleteTransaction(${x.id})">üóë ‡∏•‡∏ö</button></td></tr>`).join("");
    updateMonthSelect(all);
}
function renderStock() {
    let sold = db.sells.map(x=>x.name.trim().toLowerCase());
    let stock = db.buys.filter(x=>!sold.includes(x.name.trim().toLowerCase()));
    let key = document.getElementById("stockSearch").value.toLowerCase();
    if(key) stock = stock.filter(x=>x.name.toLowerCase().includes(key));
    document.getElementById("stockList").innerHTML = stock.map(x=>`<tr><td>${x.name}</td><td>${x.date}</td><td>${x.price.toLocaleString()}</td></tr>`).join("");
}
function renderMelt() { document.getElementById("meltList").innerHTML = db.melts.map((x,i)=>`<li>${x} <span style="color:red;cursor:pointer;" onclick="del('melts',${i},renderMelt)">[‡∏•‡∏ö]</span></li>`).join(""); }
function renderNotes() { document.getElementById("noteList").innerHTML = db.notes.map((x,i)=>`<li>${x} <span style="color:red;cursor:pointer;" onclick="del('notes',${i},renderNotes)">[‡∏•‡∏ö]</span></li>`).join(""); }
function updateMonthSelect(all) {
    let m = [...new Set(all.map(x=>x.date.substr(0,7)))].sort().reverse();
    let sel = document.getElementById("sumMonth");
    let cur = sel.value;
    sel.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô --</option>` + m.map(x=>`<option value="${x}">${x}</option>`).join("");
    if(cur) sel.value = cur;
}
function calculateMonthly() {
    let m = document.getElementById("sumMonth").value;
    if(!m) return;
    let f = (arr)=>arr.filter(x=>x.date.startsWith(m)).reduce((a,b)=>a+b.price,0);
    let b=f(db.buys), s=f(db.sells), e=f(db.expenses);
    let net = s-b-e;
    document.getElementById("summaryResult").innerHTML = `‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${s.toLocaleString()} | ‡∏ã‡∏∑‡πâ‡∏≠: ${b.toLocaleString()} | ‡∏à‡πà‡∏≤‡∏¢: ${e.toLocaleString()} <br> <h2>‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: <span class="${net>=0?'green':'red'}">${net.toLocaleString()}</span></h2>`;
}
function searchAllData() {
    let v = document.getElementById("searchAll").value.toLowerCase();
    document.querySelectorAll("#allData tr").forEach(r => r.style.display = r.innerText.toLowerCase().includes(v)?"":"none");
}

window.onload = loadData;
</script>

</body>
</html>